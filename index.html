<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>üèóÔ∏è Calcul Mur Cl√¥ture</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --primary: #3498db;
      --primary-dark: #2980b9;
      --secondary: #2ecc71;
      --danger: #e74c3c;
      --warning: #f39c12;
      --light: #f8f9fa;
      --dark: #2c3e50;
      --gray: #7f8c8d;
      --border: #e1e8ed;
      --card-bg: #ffffff;
      --text-primary: #2c3e50;
      --text-secondary: #7f8c8d;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
      --radius: 12px;
      --radius-sm: 8px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      padding: 16px;
      font-size: 16px;
    }

    .app-container {
      max-width: 500px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .app-header {
      text-align: center;
      padding: 24px 16px;
      color: white;
      flex-shrink: 0;
    }

    .app-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 8px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .app-subtitle {
      font-size: 0.9rem;
      opacity: 0.9;
      font-weight: 400;
    }

    /* Stepper */
    .stepper {
      display: flex;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border-radius: 30px;
      padding: 4px;
      margin: 0 16px 24px;
      flex-shrink: 0;
    }

    .step {
      flex: 1;
      padding: 12px 4px;
      text-align: center;
      font-size: 0.7rem;
      font-weight: 600;
      color: rgba(255,255,255,0.7);
      border-radius: 24px;
      cursor: pointer;
      transition: var(--transition);
      user-select: none;
    }

    .step.active {
      background: white;
      color: var(--primary);
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .step.completed {
      background: var(--secondary);
      color: white;
    }

    /* Screen */
    .screen {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      flex: 1;
      display: none;
      flex-direction: column;
      animation: slideIn 0.4s ease;
    }

    @keyframes slideIn {
      from { 
        opacity: 0; 
        transform: translateY(20px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }

    .screen.active {
      display: flex;
    }

    .screen-header {
      text-align: center;
      margin-bottom: 24px;
    }

    .screen-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 8px;
    }

    .screen-subtitle {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    /* Form */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      font-size: 0.95rem;
      color: var(--text-primary);
    }

    .form-input, .form-select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 1rem;
      font-family: inherit;
      background: white;
      transition: var(--transition);
      appearance: none;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .input-group {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }

    .input-group .form-group {
      flex: 1;
      margin-bottom: 0;
    }

    /* Summary Box */
    .summary-box {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: var(--radius-sm);
      padding: 20px;
      margin: 20px 0;
      border-left: 4px solid var(--primary);
    }

    .summary-title {
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 16px;
      font-size: 1.1rem;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }

    .summary-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--primary-dark);
    }

    /* Buttons */
    .button-group {
      display: flex;
      gap: 12px;
      margin-top: auto;
    }

    .btn {
      flex: 1;
      padding: 16px;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 1rem;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-secondary {
      background: var(--secondary);
      color: white;
    }

    .btn-secondary:hover {
      background: #27ae60;
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }

    .btn-outline:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
    }

    .btn-icon {
      font-size: 1.2rem;
    }

    /* Table */
    .table-container {
      overflow-x: auto;
      margin: 20px 0;
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      font-size: 0.85rem;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    th {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      font-weight: 600;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover {
      background-color: #f8f9fa;
    }

    /* Actions */
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 24px;
    }

    .action-btn {
      flex: 1;
      min-width: 120px;
      padding: 14px;
      border-radius: var(--radius-sm);
      font-weight: 500;
      font-size: 0.9rem;
      transition: var(--transition);
      border: 2px solid var(--primary);
      background: white;
      color: var(--primary);
      text-align: center;
    }

    .action-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      padding: 16px 24px;
      border-radius: var(--radius-sm);
      color: white;
      font-weight: 500;
      font-size: 0.9rem;
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      transition: transform 0.3s ease;
      max-width: 90%;
      text-align: center;
    }

    .notification.show {
      transform: translateX(-50%) translateY(0);
    }

    .notification.success {
      background: var(--secondary);
    }

    .notification.error {
      background: var(--danger);
    }

    /* OR divider */
    .or-divider {
      text-align: center;
      margin: 16px 0;
      position: relative;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .or-divider::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      background: var(--border);
      z-index: 1;
    }

    .or-divider span {
      position: relative;
      background: white;
      padding: 0 16px;
      z-index: 2;
    }

    /* Responsive */
    @media (max-width: 480px) {
      body {
        padding: 12px;
        font-size: 15px;
      }
      
      .app-title {
        font-size: 1.3rem;
      }
      
      .app-subtitle {
        font-size: 0.8rem;
      }
      
      .screen {
        padding: 20px;
      }
      
      .screen-title {
        font-size: 1.2rem;
      }
      
      .step {
        font-size: 0.6rem;
        padding: 10px 2px;
      }
      
      .input-group {
        flex-direction: column;
        gap: 12px;
      }
      
      .btn {
        padding: 14px;
        font-size: 0.95rem;
      }
      
      table {
        font-size: 0.75rem;
      }
      
      th, td {
        padding: 8px;
      }
    }

    @media (max-width: 360px) {
      body {
        padding: 8px;
      }
      
      .app-header {
        padding: 16px 12px;
      }
      
      .screen {
        padding: 16px;
      }
      
      .form-input, .form-select {
        padding: 12px;
        font-size: 0.95rem;
      }
      
      .btn {
        padding: 12px;
        font-size: 0.9rem;
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --card-bg: #1a1a1a;
        --text-primary: #ffffff;
        --text-secondary: #b0b0b0;
        --border: #333333;
      }
      
      body {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      }
      
      .summary-box {
        background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
      }
      
      .form-input, .form-select {
        background: #2c2c2c;
        color: white;
        border-color: #404040;
      }
      
      table {
        background: #2c2c2c;
        color: white;
      }
      
      tr:hover {
        background-color: #3a3a3a;
      }
    }

    /* Loading spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Progress bar */
    .progress-bar {
      height: 4px;
      background: rgba(255,255,255,0.2);
      border-radius: 2px;
      margin: 16px 0;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--secondary);
      border-radius: 2px;
      transition: width 0.3s ease;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <h1 class="app-title">üèóÔ∏è Calcul Mur Cl√¥ture</h1>
      <p class="app-subtitle">Calculez les quantit√©s et co√ªts pour votre projet</p>
    </header>

    <div class="stepper" id="stepper">
      <!-- Dynamically filled -->
    </div>

    <main class="main-content">
      <!-- √âcran 1 : Param√®tres parcelle -->
      <section id="screen1" class="screen active">
        <div class="screen-header">
          <h2 class="screen-title">üìè Dimensions Parcelle</h2>
          <p class="screen-subtitle">Entrez les dimensions de votre terrain</p>
        </div>
        
        <div class="form-group">
          <label class="form-label">üè∑Ô∏è Type de parcelle (optionnel)</label>
          <input type="text" class="form-input" id="parcelType" placeholder="Ex: R√©sidentielle, Agricole...">
        </div>
        
        <div class="form-group">
          <label class="form-label">üìê Dimensions Terrain</label>
          <div class="input-group">
            <div class="form-group">
              <input type="text" class="form-input" id="length" placeholder="Longueur (m)" inputmode="decimal">
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="width" placeholder="Largeur (m)" inputmode="decimal">
            </div>
          </div>
          
          <div class="or-divider">
            <span>OU</span>
          </div>
          
          <div class="form-group">
            <input type="text" class="form-input" id="perimeter" placeholder="P√©rim√®tre total (m)" inputmode="decimal">
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">üìè Dimensions Mur</label>
          <div class="input-group">
            <div class="form-group">
              <input type="text" class="form-input" id="wallWidth" value="0.2" inputmode="decimal">
              <small>Largeur (m)</small>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="wallHeight" value="2.0" inputmode="decimal">
              <small>Hauteur (m)</small>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">üí± Devise</label>
          <select class="form-select" id="currency">
            <option value="XOF">XOF (Franc CFA)</option>
            <option value="EUR">EUR (Euro)</option>
            <option value="USD">USD (Dollar US)</option>
          </select>
        </div>
        
        <div class="summary-box">
          <h3 class="summary-title">üìä Calculs automatiques</h3>
          <div class="summary-item">
            <span>üìè P√©rim√®tre:</span>
            <span id="displayPerimeter">-- m</span>
          </div>
          <div class="summary-item">
            <span>üìê Surface:</span>
            <span id="displayArea">-- m¬≤</span>
          </div>
        </div>
        
        <div class="button-group">
          <button class="btn btn-primary" onclick="nextScreen(1)">
            <span class="btn-icon">üöÄ</span>
            Commencer
          </button>
        </div>
      </section>

      <!-- √âcran 2 : B√©ton de propret√© -->
      <section id="screen2" class="screen">
        <div class="screen-header">
          <h2 class="screen-title">üßπ B√©ton de propret√©</h2>
          <p class="screen-subtitle">Calcul des fondations</p>
        </div>
        
        <div class="form-group">
          <label class="form-label">üìè Largeur de la fouille (m)</label>
          <input type="text" class="form-input" id="cleaningWidth" value="0.6" inputmode="decimal">
        </div>
        
        <div class="form-group">
          <label class="form-label">üìê √âpaisseur (m)</label>
          <input type="text" class="form-input" id="cleaningThickness" value="0.1" inputmode="decimal">
        </div>
        
        <div class="form-group">
          <label class="form-label">üß± Dosage ciment (kg/m¬≥)</label>
          <input type="text" class="form-input" id="cementDosage" value="350" inputmode="decimal">
        </div>
        
        <div class="form-group">
          <label class="form-label">üí∞ Prix unitaires</label>
          <div class="input-group">
            <div class="form-group">
              <input type="text" class="form-input" id="cementPrice" placeholder="Ciment/sac" value="70000" inputmode="decimal">
              <small>Ciment (XOF)</small>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="gravelPrice" placeholder="Gravier/m¬≥" value="20000" inputmode="decimal">
              <small>Gravier (XOF)</small>
            </div>
          </div>
          <div class="form-group">
            <input type="text" class="form-input" id="sandPrice" placeholder="Sable (XOF/m¬≥)" value="4000" inputmode="decimal">
          </div>
        </div>
        
        <div class="summary-box">
          <h3 class="summary-title">üìä R√©sultats</h3>
          <div class="summary-item">
            <span>„é• Volume b√©ton:</span>
            <span id="cleaningVolume">-- m¬≥</span>
          </div>
          <div class="summary-item">
            <span>üß± Ciment:</span>
            <span id="cleaningCement">-- kg</span>
          </div>
          <div class="summary-item">
            <span>üì¶ Sacs de ciment:</span>
            <span id="cleaningSacks">-- sacs</span>
          </div>
          <div class="summary-item">
            <span>üí∞ Co√ªt total:</span>
            <span id="cleaningCost">-- XOF</span>
          </div>
        </div>
        
        <div class="button-group">
          <button class="btn btn-outline" onclick="prevScreen(2)">
            <span class="btn-icon">‚¨ÖÔ∏è</span>
            Pr√©c√©dent
          </button>
          <button class="btn btn-primary" onclick="nextScreen(2)">
            Suivant
            <span class="btn-icon">‚û°Ô∏è</span>
          </button>
        </div>
      </section>

      <!-- √âcran 3 : Semelle filante -->
      <section id="screen3" class="screen">
        <div class="screen-header">
          <h2 class="screen-title">Á£â Semelle filante</h2>
          <p class="screen-subtitle">Fondations continues</p>
        </div>
        
        <div class="form-group">
          <label class="form-label">üìè Largeur de la fouille (m)</label>
          <input type="text" class="form-input" id="footingWidth" value="0.6" inputmode="decimal">
        </div>
        
        <div class="form-group">
          <label class="form-label">üìê √âpaisseur (m)</label>
          <input type="text" class="form-input" id="footingHeight" value="0.3" inputmode="decimal">
        </div>
        
        <div class="form-group">
          <label class="form-label">üß± Dosage ciment (kg/m¬≥)</label>
          <input type="text" class="form-input" id="footingCementDosage" value="350" inputmode="decimal">
        </div>
        
        <div class="form-group">
          <label class="form-label">Èí¢Á≠ã Ferraillage</label>
          <div class="input-group">
            <div class="form-group">
              <input type="text" class="form-input" id="rebarDiameterLong" value="12" inputmode="decimal">
              <small>‚åÄ Longitudinal (mm)</small>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="rebarCountLong" value="4" inputmode="decimal">
              <small>Nb barres</small>
            </div>
          </div>
          <div class="input-group">
            <div class="form-group">
              <input type="text" class="form-input" id="rebarDiameterTrans" value="8" inputmode="decimal">
              <small>‚åÄ √âtriers (mm)</small>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="rebarSpacingTrans" value="200" inputmode="decimal">
              <small>Espacement (mm)</small>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">üí∞ Prix de l'acier (XOF/kg)</label>
          <input type="text" class="form-input" id="steelPrice" value="450" inputmode="decimal">
        </div>
        
        <div class="summary-box">
          <h3 class="summary-title">üìä R√©sultats</h3>
          <div class="summary-item">
            <span>„é• Volume b√©ton:</span>
            <span id="footingVolume">-- m¬≥</span>
          </div>
          <div class="summary-item">
            <span>Èí¢Á≠ã Acier longitudinal:</span>
            <span id="footingSteelLong">-- kg</span>
          </div>
          <div class="summary-item">
            <span>‚≠ï √âtriers:</span>
            <span id="footingSteelTrans">-- kg</span>
          </div>
          <div class="summary-item">
            <span>üí∞ Co√ªt total:</span>
            <span id="footingCost">-- XOF</span>
          </div>
        </div>
        
        <div class="button-group">
          <button class="btn btn-outline" onclick="prevScreen(3)">
            <span class="btn-icon">‚¨ÖÔ∏è</span>
            Pr√©c√©dent
          </button>
          <button class="btn btn-primary" onclick="nextScreen(3)">
            Suivant
            <span class="btn-icon">‚û°Ô∏è</span>
          </button>
        </div>
      </section>

      <!-- √âcran 4 : Poteaux amorces -->
      <section id="screen4" class="screen">
        <div class="screen-header">
          <h2 class="screen-title">‡πÄ‡∏™‡∏≤ Poteaux amorces</h2>
          <p class="screen-subtitle">Fondations des poteaux</p>
        </div>
        
        <div class="form-group">
          <label class="form-label">üìè Dimensions poteau (m)</label>
          <div class="input-group">
            <div class="form-group">
              <input type="text" class="form-input" id="postWidth" value="0.3" inputmode="decimal">
              <small>Largeur</small>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="postLength" value="0.3" inputmode="decimal">
              <small>Longueur</small>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="postHeight" value="0.5" inputmode="decimal">
              <small>Hauteur</small>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">üî¢ Nombre de poteaux</label>
          <input type="text" class="form-input" id="postCount" value="10" inputmode="decimal">
        </div>
        
        <div class="form-group">
          <label class="form-label">üß± Dosage ciment (kg/m¬≥)</label>
          <input type="text" class="form-input" id="postCementDosage" value="350" inputmode="decimal">
        </div>
        
        <div class="form-group">
          <label class="form-label">Èí¢Á≠ã Ferraillage poteau</label>
          <div class="input-group">
            <div class="form-group">
              <input type="text" class="form-input" id="postRebarCount" value="4" inputmode="decimal">
              <small>Barres/poteau</small>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="postRebarDiameter" value="12" inputmode="decimal">
              <small>‚åÄ (mm)</small>
            </div>
          </div>
          <div class="form-group">
            <input type="text" class="form-input" id="postFrameSpacing" value="0.2" inputmode="decimal" placeholder="Espacement cadres (m)">
          </div>
        </div>
        
        <div class="summary-box">
          <h3 class="summary-title">üìä R√©sultats</h3>
          <div class="summary-item">
            <span>„é• Volume b√©ton:</span>
            <span id="postVolume">-- m¬≥</span>
          </div>
          <div class="summary-item">
            <span>Èí¢Á≠ã Acier longitudinal:</span>
            <span id="postSteelLong">-- kg</span>
          </div>
          <div class="summary-item">
            <span>üî≤ Cadres:</span>
            <span id="postSteelFrames">-- kg</span>
          </div>
          <div class="summary-item">
            <span>üí∞ Co√ªt total:</span>
            <span id="postCost">-- XOF</span>
          </div>
        </div>
        
        <div class="button-group">
          <button class="btn btn-outline" onclick="prevScreen(4)">
            <span class="btn-icon">‚¨ÖÔ∏è</span>
            Pr√©c√©dent
          </button>
          <button class="btn btn-primary" onclick="nextScreen(4)">
            Suivant
            <span class="btn-icon">‚û°Ô∏è</span>
          </button>
        </div>
      </section>

      <!-- √âcran 5 : Poteaux en √©l√©vation -->
      <section id="screen5" class="screen">
        <div class="screen-header">
          <h2 class="screen-title">üèóÔ∏è Poteaux en √©l√©vation</h2>
          <p class="screen-subtitle">Structure verticale</p>
        </div>
        
        <div class="form-group">
          <label class="form-label">üìê Hauteur en √©l√©vation (m)</label>
          <input type="text" class="form-input" id="elevPostHeight" value="2.0" inputmode="decimal">
        </div>
        
        <div class="form-group">
          <label class="form-label">Èí¢Á≠ã Ferraillage</label>
          <div class="input-group">
            <div class="form-group">
              <input type="text" class="form-input" id="elevPostRebarCount" value="4" inputmode="decimal">
              <small>Barres/poteau</small>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="elevPostRebarDiameter" value="12" inputmode="decimal">
              <small>‚åÄ (mm)</small>
            </div>
          </div>
          <div class="form-group">
            <input type="text" class="form-input" id="elevPostFrameSpacing" value="0.2" inputmode="decimal" placeholder="Espacement cadres (m)">
          </div>
        </div>
        
        <div class="summary-box">
          <h3 class="summary-title">üìä R√©sultats</h3>
          <div class="summary-item">
            <span>„é• Volume b√©ton:</span>
            <span id="elevPostVolume">-- m¬≥</span>
          </div>
          <div class="summary-item">
            <span>Èí¢Á≠ã Acier longitudinal:</span>
            <span id="elevPostSteelLong">-- kg</span>
          </div>
          <div class="summary-item">
            <span>üî≤ Cadres:</span>
            <span id="elevPostSteelFrames">-- kg</span>
          </div>
          <div class="summary-item">
            <span>üí∞ Co√ªt total:</span>
            <span id="elevPostCost">-- XOF</span>
          </div>
        </div>
        
        <div class="button-group">
          <button class="btn btn-outline" onclick="prevScreen(5)">
            <span class="btn-icon">‚¨ÖÔ∏è</span>
            Pr√©c√©dent
          </button>
          <button class="btn btn-primary" onclick="nextScreen(5)">
            Suivant
            <span class="btn-icon">‚û°Ô∏è</span>
          </button>
        </div>
      </section>

      <!-- √âcran 6 : Cha√Ænages -->
      <section id="screen6" class="screen">
        <div class="screen-header">
          <h2 class="screen-title">‚õìÔ∏è Cha√Ænage</h2>
          <p class="screen-subtitle">Renfort horizontal</p>
        </div>
        
        <div class="form-group">
          <label class="form-label">üìè Dimensions cha√Ænage (m)</label>
          <div class="input-group">
            <div class="form-group">
              <input type="text" class="form-input" id="beamWidth" value="0.2" inputmode="decimal">
              <small>Largeur</small>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="beamHeight" value="0.2" inputmode="decimal">
              <small>Hauteur</small>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Èí¢Á≠ã Ferraillage</label>
          <div class="input-group">
            <div class="form-group">
              <input type="text" class="form-input" id="beamRebarDiameter" value="10" inputmode="decimal">
              <small>‚åÄ (mm)</small>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="beamRebarCount" value="4" inputmode="decimal">
              <small>Nb barres</small>
            </div>
          </div>
          <div class="form-group">
            <input type="text" class="form-input" id="beamRebarSpacing" value="200" inputmode="decimal" placeholder="Espacement cadres (mm)">
          </div>
        </div>
        
        <div class="summary-box">
          <h3 class="summary-title">üìä R√©sultats</h3>
          <div class="summary-item">
            <span>„é• Volume b√©ton:</span>
            <span id="beamVolume">-- m¬≥</span>
          </div>
          <div class="summary-item">
            <span>Èí¢Á≠ã Acier longitudinal:</span>
            <span id="beamSteelLong">-- kg</span>
          </div>
          <div class="summary-item">
            <span>üî≤ Cadres:</span>
            <span id="beamSteelFrames">-- kg</span>
          </div>
          <div class="summary-item">
            <span>üí∞ Co√ªt total:</span>
            <span id="beamCost">-- XOF</span>
          </div>
        </div>
        
        <div class="button-group">
          <button class="btn btn-outline" onclick="prevScreen(6)">
            <span class="btn-icon">‚¨ÖÔ∏è</span>
            Pr√©c√©dent
          </button>
          <button class="btn btn-primary" onclick="nextScreen(6)">
            Suivant
            <span class="btn-icon">‚û°Ô∏è</span>
          </button>
        </div>
      </section>

      <!-- √âcran 7 : Mur (briques/parpaings) -->
      <section id="screen7" class="screen">
        <div class="screen-header">
          <h2 class="screen-title">üß± Mur</h2>
          <p class="screen-subtitle">Ma√ßonnerie principale</p>
        </div>
        
        <div class="form-group">
          <label class="form-label">üìè √âpaisseur du mur (m)</label>
          <input type="text" class="form-input" id="brickThickness" value="0.2" inputmode="decimal">
        </div>
        
        <div class="form-group">
          <label class="form-label">üè∑Ô∏è Type de brique</label>
          <select class="form-select" id="brickType">
            <option value="15x20x40">Brique 15x20x40</option>
            <option value="20x20x40">Brique pleine 20x20x40</option>
            <option value="20x20x50">Bloc creux 20x20x50</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">üìê Joints et enduits</label>
          <div class="input-group">
            <div class="form-group">
              <input type="text" class="form-input" id="mortarThickness" value="10" inputmode="decimal">
              <small>Joints (mm)</small>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="renderThickness" value="15" inputmode="decimal">
              <small>Enduit (mm)</small>
            </div>
          </div>
        </div>
        
        <div class="summary-box">
          <h3 class="summary-title">üìä R√©sultats</h3>
          <div class="summary-item">
            <span>„é• Volume ma√ßonnerie:</span>
            <span id="brickVolume">-- m¬≥</span>
          </div>
          <div class="summary-item">
            <span>üß± Nombre de briques:</span>
            <span id="brickCount">-- unit√©s</span>
          </div>
          <div class="summary-item">
            <span>üíß Mortier:</span>
            <span id="mortarVolume">-- m¬≥</span>
          </div>
          <div class="summary-item">
            <span>üé® Enduit:</span>
            <span id="renderVolume">-- m¬≥</span>
          </div>
          <div class="summary-item">
            <span>üí∞ Co√ªt total:</span>
            <span id="brickCost">-- XOF</span>
          </div>
        </div>
        
        <div class="button-group">
          <button class="btn btn-outline" onclick="prevScreen(7)">
            <span class="btn-icon">‚¨ÖÔ∏è</span>
            Pr√©c√©dent
          </button>
          <button class="btn btn-primary" onclick="nextScreen(7)">
            Suivant
            <span class="btn-icon">‚û°Ô∏è</span>
          </button>
        </div>
      </section>

      <!-- √âcran 8 : R√©capitulatif -->
      <section id="screen8" class="screen">
        <div class="screen-header">
          <h2 class="screen-title">üìã R√©capitulatif</h2>
          <p class="screen-subtitle">Devis complet du projet</p>
        </div>
        
        <div class="summary-box">
          <h3 class="summary-title">üí∞ Co√ªts totaux</h3>
          <div class="summary-item">
            <span>üß± Mat√©riaux:</span>
            <span id="totalMaterials">-- XOF</span>
          </div>
          <div class="summary-item">
            <span>üë∑ Main d'≈ìuvre:</span>
            <span id="labourCost">-- XOF</span>
          </div>
          <div class="summary-item">
            <span>üí∞ Total g√©n√©ral:</span>
            <span id="grandTotal">-- XOF</span>
          </div>
        </div>
        
        <div class="table-container">
          <table id="summaryTable">
            <thead>
              <tr>
                <th>√âl√©ment</th>
                <th>Vol</th>
                <th>Ciment</th>
                <th>Sacs</th>
                <th>Acier</th>
                <th>Co√ªt</th>
              </tr>
            </thead>
            <tbody>
              <!-- Dynamically filled -->
            </tbody>
          </table>
        </div>
        
        <div class="actions">
          <button class="action-btn" onclick="prevScreen(8)">
            <span class="btn-icon">‚úèÔ∏è</span>
            Modifier
          </button>
          <button class="action-btn" onclick="exportPDF()">
            <span class="btn-icon">üìÑ</span>
            PDF
          </button>
          <button class="action-btn" onclick="exportJSON()">
            <span class="btn-icon">üíæ</span>
            JSON
          </button>
          <button class="action-btn" onclick="exportCSV()">
            <span class="btn-icon">üìä</span>
            CSV
          </button>
        </div>
      </section>
    </main>
  </div>

  <div class="notification" id="notification"></div>

  <script>
    // Global state
    let currentScreen = 1;
    const totalScreens = 8;
    let projectData = {
      metadata: {
        date: new Date().toISOString(),
        client: "Client Exemple",
        parcelle: {}
      },
      items: [],
      total: {
        materials: 0,
        labour: 0,
        grand_total: 0
      }
    };

    // Initialize stepper
    function initStepper() {
      const stepper = document.getElementById('stepper');
      stepper.innerHTML = '';
      for (let i = 1; i <= totalScreens; i++) {
        const step = document.createElement('div');
        step.className = 'step';
        step.textContent = i;
        step.dataset.screen = i;
        step.onclick = () => goToScreen(i);
        stepper.appendChild(step);
      }
      updateStepper();
    }

    function updateStepper() {
      const steps = document.querySelectorAll('.step');
      steps.forEach((step, index) => {
        step.classList.remove('active', 'completed');
        if (index + 1 === currentScreen) {
          step.classList.add('active');
        } else if (index + 1 < currentScreen) {
          step.classList.add('completed');
        }
      });
    }

    function goToScreen(screen) {
      if (screen <= currentScreen) {
        document.getElementById(`screen${currentScreen}`).classList.remove('active');
        currentScreen = screen;
        document.getElementById(`screen${currentScreen}`).classList.add('active');
        updateStepper();
      }
    }

    function nextScreen(screen) {
      if (validateScreen(screen)) {
        document.getElementById(`screen${screen}`).classList.remove('active');
        currentScreen++;
        document.getElementById(`screen${currentScreen}`).classList.add('active');
        updateStepper();
        if (currentScreen === 2) calculateScreen1();
        if (currentScreen === 3) calculateScreen2();
        if (currentScreen === 4) calculateScreen3();
        if (currentScreen === 5) calculateScreen4();
        if (currentScreen === 6) calculateScreen5();
        if (currentScreen === 7) calculateScreen6();
        if (currentScreen === 8) calculateScreen7();
      }
    }

    function prevScreen(screen) {
      document.getElementById(`screen${screen}`).classList.remove('active');
      currentScreen--;
      document.getElementById(`screen${currentScreen}`).classList.add('active');
      updateStepper();
    }

    function validateScreen(screen) {
      let valid = true;
      let error = "";
      if (screen === 1) {
        const length = parseFloat(document.getElementById('length').value.replace(',', '.'));
        const width = parseFloat(document.getElementById('width').value.replace(',', '.'));
        const perimeter = parseFloat(document.getElementById('perimeter').value.replace(',', '.'));
        if ((isNaN(length) || isNaN(width)) && isNaN(perimeter)) {
          error = "Entrez les dimensions ou le p√©rim√®tre";
          valid = false;
        }
      }
      if (!valid) {
        showNotification(error, 'error');
      }
      return valid;
    }

    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    function calculateScreen1() {
      const length = parseFloat(document.getElementById('length').value.replace(',', '.'));
      const width = parseFloat(document.getElementById('width').value.replace(',', '.'));
      let perimeter = parseFloat(document.getElementById('perimeter').value.replace(',', '.'));
      const wallWidth = parseFloat(document.getElementById('wallWidth').value.replace(',', '.'));
      const wallHeight = parseFloat(document.getElementById('wallHeight').value.replace(',', '.'));

      if (!isNaN(length) && !isNaN(width)) {
        perimeter = 2 * (length + width);
        document.getElementById('perimeter').value = perimeter.toFixed(2);
      }

      const area = length && width ? length * width : 0;

      document.getElementById('displayPerimeter').textContent = perimeter ? perimeter.toFixed(2) + ' m' : '-- m';
      document.getElementById('displayArea').textContent = area ? area.toFixed(2) + ' m¬≤' : '-- m¬≤';

      projectData.metadata.parcelle = {
        perimetre: perimeter || 0,
        surface: area || 0,
        L: length || 0,
        W: width || 0
      };
    }

    function calculateScreen2() {
      const perimeter = projectData.metadata.parcelle.perimetre || 0;
      const width = parseFloat(document.getElementById('cleaningWidth').value.replace(',', '.'));
      const thickness = parseFloat(document.getElementById('cleaningThickness').value.replace(',', '.'));
      const dosage = parseFloat(document.getElementById('cementDosage').value.replace(',', '.'));
      const cementPrice = parseFloat(document.getElementById('cementPrice').value.replace(',', '.'));
      const gravelPrice = parseFloat(document.getElementById('gravelPrice').value.replace(',', '.'));
      const sandPrice = parseFloat(document.getElementById('sandPrice').value.replace(',', '.'));

      const volume = perimeter * width * thickness;
      const cementKg = volume * dosage;
      const sacks = Math.ceil(cementKg / 50);
      const gravelVol = volume * 0.8;
      const sandVol = volume * 0.45;

      const cost = sacks * cementPrice + gravelVol * gravelPrice + sandVol * sandPrice;

      document.getElementById('cleaningVolume').textContent = volume.toFixed(2) + ' m¬≥';
      document.getElementById('cleaningCement').textContent = cementKg.toFixed(2) + ' kg';
      document.getElementById('cleaningSacks').textContent = sacks + ' sacs';
      document.getElementById('cleaningCost').textContent = cost.toFixed(2) + ' XOF';

      projectData.items[0] = {
        name: "B√©ton de propret√©",
        volume_m3: volume,
        cement_kg: cementKg,
        sacks: sacks,
        gravel_m3: gravelVol,
        sand_m3: sandVol,
        costs: {
          cement: sacks * cementPrice,
          gravel: gravelVol * gravelPrice,
          sand: sandVol * sandPrice
        }
      };
    }

    function calculateScreen3() {
      const perimeter = projectData.metadata.parcelle.perimetre || 0;
      const width = parseFloat(document.getElementById('footingWidth').value.replace(',', '.'));
      const height = parseFloat(document.getElementById('footingHeight').value.replace(',', '.'));
      const dosage = parseFloat(document.getElementById('footingCementDosage').value.replace(',', '.'));
      const rebarDiamLong = parseFloat(document.getElementById('rebarDiameterLong').value.replace(',', '.'));
      const rebarCountLong = parseFloat(document.getElementById('rebarCountLong').value.replace(',', '.'));
      const rebarDiamTrans = parseFloat(document.getElementById('rebarDiameterTrans').value.replace(',', '.'));
      const rebarSpacingTrans = parseFloat(document.getElementById('rebarSpacingTrans').value.replace(',', '.')) / 1000;
      const steelPrice = parseFloat(document.getElementById('steelPrice').value.replace(',', '.'));

      const volume = perimeter * width * height;
      const cementKg = volume * dosage;
      const sacks = Math.ceil(cementKg / 50);
      const gravelVol = volume * 0.8;
      const sandVol = volume * 0.45;

      // Steel calculations
      const steelLongLength = perimeter * rebarCountLong;
      const steelLongMass = steelLongLength * 0.006165177 * rebarDiamLong * rebarDiamLong;

      const transCount = Math.ceil(perimeter / rebarSpacingTrans);
      const transLength = (2 * width + 2 * height) + 2 * 0.1; // Adding hooks
      const steelTransMass = transCount * transLength * 0.006165177 * rebarDiamTrans * rebarDiamTrans;

      const totalSteelMass = steelLongMass + steelTransMass;
      const steelCost = totalSteelMass * steelPrice;

      const cost = sacks * 70000 + gravelVol * 20000 + sandVol * 4000 + steelCost;

      document.getElementById('footingVolume').textContent = volume.toFixed(2) + ' m¬≥';
      document.getElementById('footingSteelLong').textContent = steelLongMass.toFixed(2) + ' kg';
      document.getElementById('footingSteelTrans').textContent = steelTransMass.toFixed(2) + ' kg';
      document.getElementById('footingCost').textContent = cost.toFixed(2) + ' XOF';

      projectData.items[1] = {
        name: "Semelle filante",
        volume_m3: volume,
        cement_kg: cementKg,
        sacks: sacks,
        gravel_m3: gravelVol,
        sand_m3: sandVol,
        steel_kg: totalSteelMass,
        costs: {
          cement: sacks * 70000,
          gravel: gravelVol * 20000,
          sand: sandVol * 4000,
          steel: steelCost
        }
      };
    }

    function calculateScreen4() {
      const postWidth = parseFloat(document.getElementById('postWidth').value.replace(',', '.'));
      const postLength = parseFloat(document.getElementById('postLength').value.replace(',', '.'));
      const postHeight = parseFloat(document.getElementById('postHeight').value.replace(',', '.'));
      const postCount = parseFloat(document.getElementById('postCount').value.replace(',', '.'));
      const dosage = parseFloat(document.getElementById('postCementDosage').value.replace(',', '.'));
      const rebarCount = parseFloat(document.getElementById('postRebarCount').value.replace(',', '.'));
      const rebarDiameter = parseFloat(document.getElementById('postRebarDiameter').value.replace(',', '.'));
      const frameSpacing = parseFloat(document.getElementById('postFrameSpacing').value.replace(',', '.'));

      const volume = postWidth * postLength * postHeight * postCount;
      const cementKg = volume * dosage;
      const sacks = Math.ceil(cementKg / 50);
      const gravelVol = volume * 0.8;
      const sandVol = volume * 0.45;

      // Steel calculations
      const steelLongLength = postHeight * rebarCount * postCount;
      const steelLongMass = steelLongLength * 0.006165177 * rebarDiameter * rebarDiameter;

      const frameCount = Math.floor(postHeight / frameSpacing) * postCount;
      const frameLength = 2 * (postWidth + postLength) + 0.2; // Adding hooks
      const steelFrameMass = frameCount * frameLength * 0.006165177 * 8 * 8;

      const totalSteelMass = steelLongMass + steelFrameMass;
      const steelCost = totalSteelMass * 450;

      const cost = sacks * 70000 + gravelVol * 20000 + sandVol * 4000 + steelCost;

      document.getElementById('postVolume').textContent = volume.toFixed(2) + ' m¬≥';
      document.getElementById('postSteelLong').textContent = steelLongMass.toFixed(2) + ' kg';
      document.getElementById('postSteelFrames').textContent = steelFrameMass.toFixed(2) + ' kg';
      document.getElementById('postCost').textContent = cost.toFixed(2) + ' XOF';

      projectData.items[2] = {
        name: "Poteaux amorces",
        volume_m3: volume,
        cement_kg: cementKg,
        sacks: sacks,
        gravel_m3: gravelVol,
        sand_m3: sandVol,
        steel_kg: totalSteelMass,
        costs: {
          cement: sacks * 70000,
          gravel: gravelVol * 20000,
          sand: sandVol * 4000,
          steel: steelCost
        }
      };
    }

    function calculateScreen5() {
      const postHeight = parseFloat(document.getElementById('elevPostHeight').value.replace(',', '.'));
      const postCount = projectData.items[2] ? projectData.items[2].volume_m3 / (0.3 * 0.3 * 0.5) : 10;
      const rebarCount = parseFloat(document.getElementById('elevPostRebarCount').value.replace(',', '.'));
      const rebarDiameter = parseFloat(document.getElementById('elevPostRebarDiameter').value.replace(',', '.'));
      const frameSpacing = parseFloat(document.getElementById('elevPostFrameSpacing').value.replace(',', '.'));

      const postWidth = 0.3;
      const postLength = 0.3;
      const volume = postWidth * postLength * postHeight * postCount;
      const cementKg = volume * 350;
      const sacks = Math.ceil(cementKg / 50);
      const gravelVol = volume * 0.8;
      const sandVol = volume * 0.45;

      // Steel calculations
      const steelLongLength = postHeight * rebarCount * postCount;
      const steelLongMass = steelLongLength * 0.006165177 * rebarDiameter * rebarDiameter;

      const frameCount = Math.floor(postHeight / frameSpacing) * postCount;
      const frameLength = 2 * (postWidth + postLength) + 0.2;
      const steelFrameMass = frameCount * frameLength * 0.006165177 * 8 * 8;

      const totalSteelMass = steelLongMass + steelFrameMass;
      const steelCost = totalSteelMass * 450;

      const cost = sacks * 70000 + gravelVol * 20000 + sandVol * 4000 + steelCost;

      document.getElementById('elevPostVolume').textContent = volume.toFixed(2) + ' m¬≥';
      document.getElementById('elevPostSteelLong').textContent = steelLongMass.toFixed(2) + ' kg';
      document.getElementById('elevPostSteelFrames').textContent = steelFrameMass.toFixed(2) + ' kg';
      document.getElementById('elevPostCost').textContent = cost.toFixed(2) + ' XOF';

      projectData.items[3] = {
        name: "Poteaux en √©l√©vation",
        volume_m3: volume,
        cement_kg: cementKg,
        sacks: sacks,
        gravel_m3: gravelVol,
        sand_m3: sandVol,
        steel_kg: totalSteelMass,
        costs: {
          cement: sacks * 70000,
          gravel: gravelVol * 20000,
          sand: sandVol * 4000,
          steel: steelCost
        }
      };
    }

    function calculateScreen6() {
      const perimeter = projectData.metadata.parcelle.perimetre || 0;
      const beamWidth = parseFloat(document.getElementById('beamWidth').value.replace(',', '.'));
      const beamHeight = parseFloat(document.getElementById('beamHeight').value.replace(',', '.'));
      const rebarDiameter = parseFloat(document.getElementById('beamRebarDiameter').value.replace(',', '.'));
      const rebarCount = parseFloat(document.getElementById('beamRebarCount').value.replace(',', '.'));
      const rebarSpacing = parseFloat(document.getElementById('beamRebarSpacing').value.replace(',', '.')) / 1000;

      const volume = perimeter * beamWidth * beamHeight * 2; // Bas + Couronnement
      const cementKg = volume * 350;
      const sacks = Math.ceil(cementKg / 50);
      const gravelVol = volume * 0.8;
      const sandVol = volume * 0.45;

      // Steel calculations
      const steelLongLength = perimeter * rebarCount * 2;
      const steelLongMass = steelLongLength * 0.006165177 * rebarDiameter * rebarDiameter;

      const frameCount = Math.ceil(perimeter / rebarSpacing) * 2;
      const frameLength = (beamWidth + beamHeight) * 2 + 0.2;
      const steelFrameMass = frameCount * frameLength * 0.006165177 * 8 * 8;

      const totalSteelMass = steelLongMass + steelFrameMass;
      const steelCost = totalSteelMass * 450;

      const cost = sacks * 70000 + gravelVol * 20000 + sandVol * 4000 + steelCost;

      document.getElementById('beamVolume').textContent = volume.toFixed(2) + ' m¬≥';
      document.getElementById('beamSteelLong').textContent = steelLongMass.toFixed(2) + ' kg';
      document.getElementById('beamSteelFrames').textContent = steelFrameMass.toFixed(2) + ' kg';
      document.getElementById('beamCost').textContent = cost.toFixed(2) + ' XOF';

      projectData.items[4] = {
        name: "Cha√Ænage bas & Couronnement",
        volume_m3: volume,
        cement_kg: cementKg,
        sacks: sacks,
        gravel_m3: gravelVol,
        sand_m3: sandVol,
        steel_kg: totalSteelMass,
        costs: {
          cement: sacks * 70000,
          gravel: gravelVol * 20000,
          sand: sandVol * 4000,
          steel: steelCost
        }
      };
    }

    function calculateScreen7() {
      const perimeter = projectData.metadata.parcelle.perimetre || 0;
      const height = projectData.metadata.parcelle.W ? projectData.metadata.parcelle.W : 2;
      const thickness = parseFloat(document.getElementById('brickThickness').value.replace(',', '.'));
      const brickType = document.getElementById('brickType').value;
      const mortarThickness = parseFloat(document.getElementById('mortarThickness').value.replace(',', '.')) / 1000;
      const renderThickness = parseFloat(document.getElementById('renderThickness').value.replace(',', '.')) / 1000;

      let brickDims = [0.15, 0.2, 0.4]; // Default
      if (brickType === "20x20x40") brickDims = [0.2, 0.2, 0.4];
      if (brickType === "20x20x50") brickDims = [0.2, 0.2, 0.5];

      const brickVol = (brickDims[0] + mortarThickness) * (brickDims[1] + mortarThickness) * (brickDims[2] + mortarThickness);
      const wallVol = perimeter * height * thickness;
      const brickCount = Math.ceil(wallVol / brickVol);

      const mortarVol = wallVol * 0.15; // Approx
      const renderVol = perimeter * height * 2 * renderThickness; // Both sides

      const cost = brickCount * 100 + mortarVol * 5000 + renderVol * 6000;

      document.getElementById('brickVolume').textContent = wallVol.toFixed(2) + ' m¬≥';
      document.getElementById('brickCount').textContent = brickCount + ' unit√©s';
      document.getElementById('mortarVolume').textContent = mortarVol.toFixed(2) + ' m¬≥';
      document.getElementById('renderVolume').textContent = renderVol.toFixed(2) + ' m¬≥';
      document.getElementById('brickCost').textContent = cost.toFixed(2) + ' XOF';

      projectData.items[5] = {
        name: "Mur (briques/parpaings)",
        volume_m3: wallVol,
        brick_count: brickCount,
        mortar_m3: mortarVol,
        render_m3: renderVol,
        costs: {
          bricks: brickCount * 100,
          mortar: mortarVol * 5000,
          render: renderVol * 6000
        }
      };

      calculateSummary();
    }

    function calculateSummary() {
      let totalMaterials = 0;
      let totalLabour = 0;
      let grandTotal = 0;

      projectData.items.forEach(item => {
        if (item.costs) {
          Object.values(item.costs).forEach(val => totalMaterials += val);
        }
      });

      totalLabour = totalMaterials * 0.3; // 30% main d'≈ìuvre
      grandTotal = totalMaterials + totalLabour;

      projectData.total.materials = totalMaterials;
      projectData.total.labour = totalLabour;
      projectData.total.grand_total = grandTotal;

      document.getElementById('totalMaterials').textContent = totalMaterials.toFixed(2) + ' XOF';
      document.getElementById('labourCost').textContent = totalLabour.toFixed(2) + ' XOF';
      document.getElementById('grandTotal').textContent = grandTotal.toFixed(2) + ' XOF';

      const tbody = document.getElementById('summaryTable').querySelector('tbody');
      tbody.innerHTML = '';
      projectData.items.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.volume_m3 ? item.volume_m3.toFixed(1) : ''}</td>
          <td>${item.cement_kg ? item.cement_kg.toFixed(0) : ''}</td>
          <td>${item.sacks || ''}</td>
          <td>${item.steel_kg ? item.steel_kg.toFixed(0) : ''}</td>
          <td>${Object.values(item.costs || {}).reduce((a,b) => a+b, 0).toFixed(0)}</td>
        `;
        tbody.appendChild(row);
      });
    }

    function exportPDF() {
      showNotification("Export PDF simul√©", 'success');
    }

    function exportJSON() {
      const dataStr = "text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(projectData, null, 2));
      const downloadAnchorNode = document.createElement('a');
      downloadAnchorNode.setAttribute("href", dataStr);
      downloadAnchorNode.setAttribute("download", "devis_mur.json");
      document.body.appendChild(downloadAnchorNode);
      downloadAnchorNode.click();
      downloadAnchorNode.remove();
      showNotification("JSON t√©l√©charg√©!", 'success');
    }

    function exportCSV() {
      let csv = '√âl√©ment,Volume (m¬≥),Ciment (kg),Sacs,Acier (kg),Co√ªt (XOF)\n';
      projectData.items.forEach(item => {
        csv += `"${item.name}",${item.volume_m3 || ''},${item.cement_kg || ''},${item.sacks || ''},${item.steel_kg || ''},${Object.values(item.costs || {}).reduce((a,b) => a+b, 0)}\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      const url = URL.createObjectURL(blob);
      link.setAttribute("href", url);
      link.setAttribute("download", "devis_mur.csv");
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      showNotification("CSV t√©l√©charg√©!", 'success');
    }

    // Initialize
    window.onload = function() {
      initStepper();
    };
  </script>
</body>
</html>
